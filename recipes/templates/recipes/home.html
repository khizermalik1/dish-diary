<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Welcome to Dish Diary ‚Äî discover, create, and share your favorite recipes with the world."
    />

    <title>DishDiary</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <style>
      body {
        font-family: "Georgia", serif;
        background-color: #ffe5d9;
        color: #3e3e3e;
      }
      .navbar {
        background-color: #fff0e6;
        border-bottom: 2px solid #ffb997;
      }
      .navbar-brand {
        font-weight: bold;
        font-size: 1.5rem;
        color: #d35400;
      }
      .nav-link {
        color: #d35400 !important;
        font-weight: 600;
        font-family: "Georgia", serif;
      }
      .hero {
        background-image: url("https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1600&q=80");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        color: white;
        padding: 4rem 2rem;
        text-align: center;
        border-radius: 0 0 20px 20px;
        box-shadow: inset 0 0 0 1000px rgba(0, 0, 0, 0.4);
      }
      .hero h1 {
        font-size: 3rem;
        font-weight: 700;
      }
      .hero p {
        font-size: 1.2rem;
        margin-top: 1rem;
      }
      .card {
        border-radius: 16px;
        background-color: #ffb997;
        border: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      .card-title {
        color: #d35400;
        font-weight: 600;
      }
      .btn-outline-danger {
        border-color: #d35400;
        color: #d35400;
      }
      .btn-outline-danger:hover {
        background-color: #d35400;
        color: white;
      }
      .card-title {
        color: #a80000; /* darker red for better contrast */
      }

      .btn-outline-danger {
        border-color: #a80000;
        color: #a80000;
      }

      .btn-outline-danger:hover {
        background-color: #a80000;
        color: white;
      }

      .text-muted {
        color: #5c5c5c !important;
      }

      button:focus,
      a:focus {
        outline: 2px solid #d35400;
        outline-offset: 2px;
      }
    </style>
  </head>
  <body>
    {% include 'recipes/navbar.html' %}

    <section class="hero">
      <h1>Welcome to DishDiary</h1>
      <p>Cook, share, and discover recipes that bring joy to your kitchen.</p>
    </section>
    <div class="container mt-4">
      <form
        method="get"
        action="{% url 'recipes:search_recipes' %}"
        class="d-flex"
      >
        <input
          type="text"
          name="q"
          class="form-control me-2"
          placeholder="Search recipes..."
          required
        />
        <button type="submit" class="btn btn-outline-danger">Search</button>
      </form>
    </div>

    {% if user.is_authenticated %}
    <div class="container mt-4 text-end">
      <a href="{% url 'recipes:create_recipe' %}" class="btn btn-danger"
        >Post a Recipe</a
      >
    </div>
    {% endif %}

    <div class="container mt-5">
      <h2 class="text-center mb-4">Most Popular Recipes</h2>
      <div class="row">
        {% for recipe in popular_recipes %}
        <div class="col-md-6 col-lg-3 mb-4">
          <div class="card h-100">
            <div class="card-body d-flex flex-column justify-content-between">
              <div>
                <h3 class="card-title">{{ recipe.title }}</h3>
                <p class="card-text">{{ recipe.summary|truncatewords:20 }}</p>
                <p class="text-muted small mt-2">
                  ‚ù§Ô∏è {{ recipe.like_count }} like{{ recipe.like_count|pluralize
                  }}, üí¨ {{ recipe.comment_count }} comment{{
                  recipe.comment_count|pluralize }}
                </p>
              </div>
              <a
                href="{% url 'recipes:recipe_detail' slug=recipe.slug %}"
                class="btn btn-outline-danger mt-3"
                >View Recipe</a
              >
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12">
          <p class="text-muted text-center">No popular recipes yet.</p>
        </div>
        {% endfor %}
      </div>
    </div>

    <div class="container mt-5">
      <h2 class="text-center mb-4">Latest Recipes</h2>
      <div class="row">
        {% for recipe in recipes %}
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card h-100">
            <div class="card-body d-flex flex-column justify-content-between">
              <div>
                <h3 class="card-title">{{ recipe.title }}</h3>
                <p class="card-text">{{ recipe.summary|truncatewords:20 }}</p>
                <p class="text-muted small mt-2">
                  ‚ù§Ô∏è {{ recipe.like_count }} like{{ recipe.like_count|pluralize}}, üí¨ {{ recipe.comment_count }} comment{{recipe.comment_count|pluralize }}
                </p>
              </div>
              <a
                href="{% url 'recipes:recipe_detail' slug=recipe.slug %}"
                class="btn btn-outline-danger mt-3"
                >View Recipe</a
              >
              {% if user.is_authenticated and recipe.author == user or
              user.is_superuser %}
              <div class="mt-3 d-flex justify-content-between">
                <a
                  href="{% url 'recipes:edit_recipe' slug=recipe.slug %}"
                  class="btn btn-sm btn-outline-secondary"
                  >Edit</a
                >
                <button
                  type="button"
                  class="btn btn-sm btn-outline-danger"
                  data-bs-toggle="modal"
                  data-bs-target="#confirmDeleteModal-{{ recipe.slug }}"
                >
                  Delete
                </button>
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        {% if user.is_authenticated and recipe.author == user or
        user.is_superuser %}
        <div
          class="modal fade"
          id="confirmDeleteModal-{{ recipe.slug }}"
          tabindex="-1"
          aria-labelledby="confirmDeleteModalLabel-{{ recipe.slug }}"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background-color: #fff0e6">
              <div class="modal-header">
                <h3
                  class="modal-title"
                  id="confirmDeleteModalLabel-{{ recipe.slug }}"
                >
                  Confirm Deletion
                </h3>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                Are you sure you want to delete
                <strong>{{ recipe.title }}</strong>? This action cannot be
                undone.
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Cancel
                </button>
                <form
                  method="post"
                  action="{% url 'recipes:delete_recipe' slug=recipe.slug %}"
                >
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger">
                    Yes, Delete
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
        {% endif %} {% empty %}
        <div class="col-12">
          <p class="text-muted text-center">
            No recipes yet. Be the first to add one!
          </p>
        </div>
        {% endfor %}
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
